<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
    <meta charset="UTF-8" />
    <title>تحلیل احساس توییت</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <style>
        :root {
            --bg: #0f1115;
            --card: #1b1f27;
            --accent: #6366f1;
            --accent-hover: #4f46e5;
            --ok: #16a34a;
            --bad: #dc2626;
            --mid: #d97706;
            --text: #e5e7eb;
            --muted: #94a3b8;
            --radius: 14px;
        }

        * {
            box-sizing: border-box;
            font-family: Vazirmatn, "IRANSans", system-ui, sans-serif;
        }

        body {
            margin: 0;
            background: radial-gradient(circle at 30% 20%, #1e2533, #0f1115 70%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 32px;
            color: var(--text);
        }

        .app {
            width: 100%;
            max-width: 760px;
            background: var(--card);
            border: 1px solid #232a36;
            padding: 32px 38px 42px;
            border-radius: var(--radius);
            box-shadow: 0 10px 40px -10px #000;
            position: relative;
            overflow: hidden;
        }

        .app:before,
        .app:after {
            content: "";
            position: absolute;
            width: 220px;
            height: 220px;
            border-radius: 50%;
            background: linear-gradient(135deg, #313c52, #0f1115);
            filter: blur(40px);
            opacity: .35;
            animation: float 12s linear infinite;
        }

        .app:before {
            top: -80px;
            left: -70px;
        }

        .app:after {
            bottom: -90px;
            right: -60px;
            animation-direction: reverse;
        }

        @keyframes float {
            0% {
                transform: translateY(0)
            }

            50% {
                transform: translateY(25px)
            }

            100% {
                transform: translateY(0)
            }
        }

        h1 {
            margin: 0 0 10px;
            font-size: 1.55rem;
            letter-spacing: .5px;
        }

        p.subtitle {
            margin: 0 0 28px;
            color: var(--muted);
            font-size: .92rem;
        }

        textarea {
            width: 100%;
            background: #13171f;
            color: var(--text);
            border: 1px solid #2a3140;
            padding: 14px 16px;
            border-radius: 12px;
            resize: vertical;
            min-height: 130px;
            font-size: .95rem;
            line-height: 1.5;
            outline: none;
            transition: .25s;
        }

        textarea:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 1px var(--accent);
        }

        .row {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        button {
            background: var(--accent);
            color: #fff;
            border: none;
            padding: 14px 26px;
            font-size: .95rem;
            border-radius: 12px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            letter-spacing: .3px;
            transition: .25s;
        }

        button:hover {
            background: var(--accent-hover);
        }

        button:disabled {
            opacity: .45;
            cursor: not-allowed;
        }

        .status {
            margin-top: 28px;
            padding: 18px 22px;
            border-radius: 12px;
            background: #141a23;
            border: 1px solid #2b3442;
            display: none;
            position: relative;
        }

        .status.loading:before {
            content: "";
            position: absolute;
            inset: 0;
            background:
                repeating-linear-gradient(125deg, rgba(255, 255, 255, .02) 0 12px, transparent 12px 24px);
            animation: move 12s linear infinite;
        }

        @keyframes move {
            0% {
                background-position: 0 0
            }

            100% {
                background-position: 600px 0
            }
        }

        .pill {
            display: inline-block;
            padding: 4px 12px 5px;
            border-radius: 30px;
            font-size: .78rem;
            letter-spacing: .5px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .pill.positive {
            background: rgba(22, 163, 74, .12);
            color: var(--ok);
            border: 1px solid rgba(22, 163, 74, .4);
        }

        .pill.negative {
            background: rgba(220, 38, 38, .12);
            color: var(--bad);
            border: 1px solid rgba(220, 38, 38, .45);
        }

        .pill.neutral {
            background: rgba(217, 119, 6, .12);
            color: var(--mid);
            border: 1px solid rgba(217, 119, 6, .45);
        }

        .fade-in {
            animation: fade .4s ease;
        }

        @keyframes fade {
            from {
                opacity: 0;
                transform: translateY(4px)
            }

            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        footer {
            margin-top: 40px;
            font-size: .7rem;
            text-align: center;
            color: #556072;
        }

        .mini {
            font-size: .70rem;
            margin-top: 6px;
            color: #6b7788;
        }

        .spinner {
            width: 18px;
            height: 18px;
            border: 3px solid #ffffff40;
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin .8s linear infinite;
            display: inline-block;
            vertical-align: middle;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .error {
            color: #f87171;
            font-size: .8rem;
            margin-top: 8px;
            display: none;
        }

        .api-json {
            margin-top: 14px;
            font-family: ui-monospace, monospace;
            background: #10161f;
            border: 1px solid #233041;
            padding: 14px 16px;
            border-radius: 10px;
            font-size: .72rem;
            line-height: 1.5;
            direction: ltr;
            overflow: auto;
            max-height: 180px;
            display: none;
        }

        .toggle-json {
            background: #1f2732;
            color: #c1c9d4;
            border: 1px solid #2f3a47;
            font-size: .7rem;
            padding: 8px 14px;
        }

        .toggle-json:hover {
            background: #293341;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" crossorigin="anonymous"></script>
</head>

<body>
    <div class="app">
        <h1>تحلیل احساس متن توییت</h1>
        <p class="subtitle">مدل CNN + LSTM روی دیتاست Twitter Entity Sentiment. یک متن وارد و ارسال کن.</p>
        <label for="text"
            style="display:block; font-size:.78rem; letter-spacing:.5px; margin-bottom:6px; color:#93a1b4;">
            متن (Ctrl+Enter = ارسال)
        </label>
        <textarea id="text" placeholder="مثال: I really love this product, it's fantastic..."></textarea>
        <div class="row">
            <button id="sendBtn">
                <span class="btn-text">ارسال تحلیل</span>
            </button>
            <button type="button" class="toggle-json" id="toggleJson">نمایش JSON</button>
        </div>
        <div class="error" id="errBox"></div>
        <div class="status" id="statusBox">
            <div id="predWrap"></div>
            <div class="mini" id="extraInfo"></div>
        </div>
        <div class="api-json" id="jsonBox"></div>
        <footer>Frontend ساده • FastAPI + jQuery</footer>
    </div>

    <script>
        const endpoints = { predict: "/predict" };
        let lastResponse = null;

        function classifyPill(label) {
            if (!label) return "";
            return `<span class="pill ${label}">${label}</span>`;
        }

        function setLoading(state) {
            const btn = $("#sendBtn");
            if (state) {
                btn.prop("disabled", true);
                btn.find(".btn-text").html('<span class="spinner"></span> در حال پردازش');
                $("#statusBox").addClass("loading").show();
                $("#predWrap").html("...");
                $("#extraInfo").text("");
            } else {
                btn.prop("disabled", false);
                btn.find(".btn-text").text("ارسال تحلیل");
                $("#statusBox").removeClass("loading");
            }
        }

        function sendPredict() {
            const text = $("#text").val().trim();
            $("#errBox").hide();
            if (!text) {
                $("#errBox").text("متنی وارد نشده.").fadeIn(120);
                return;
            }
            setLoading(true);
            $.ajax({
                url: endpoints.predict,
                method: "POST",
                data: JSON.stringify({ text }),
                contentType: "application/json",
                success: (data) => {
                    lastResponse = data;
                    const pill = classifyPill(data.sentiment);
                    $("#predWrap").html(`<div class="fade-in" style="font-size:1.05rem; font-weight:500;">
            نتیجه: ${pill}
          </div>`);
                    $("#extraInfo").text(`کد عددی: ${data.sentiment_numeric}`);
                    $("#jsonBox").text(JSON.stringify(data, null, 2));
                },
                error: (xhr) => {
                    $("#errBox").text("خطا در ارتباط با سرور").fadeIn(150);
                },
                complete: () => setLoading(false)
            });
        }

        $("#sendBtn").on("click", sendPredict);
        $("#text").on("keydown", (e) => {
            if (e.key === "Enter" && e.ctrlKey) {
                sendPredict();
            }
        });
        $("#toggleJson").on("click", () => {
            $("#jsonBox").slideToggle(180);
        });
    </script>
</body>

</html>